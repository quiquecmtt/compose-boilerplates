name: time-machine

services:
  app:
    image: docker.io/mbentley/timemachine:smb
    hostname: ${TM_HOSTNAME:?err}
    environment:
      TM_USERNAME: ${TM_USERNAME:?err}
      TM_GROUPNAME: ${TM_GROUPNAME:?err}
      PASSWORD: ${PASSWORD:?err}
      TM_UID: ${TM_UID:?err}
      TM_GID: ${TM_GID:?err}
      SET_PERMISSIONS: ${SET_PERMISSIONS:?err}
      VOLUME_SIZE_LIMIT: ${VOLUME_SIZE_LIMIT:?err}
    volumes:
      - ${TM_BACKUP_PATH:?err}:/opt/${TM_USERNAME:?err}
      - type: tmpfs
        target: /run/samba
    restart: unless-stopped

networks:
  default:
    driver: macvlan
    driver_opts:
      parent: ${MVLAN_IF:?err}
    ipam:
      config:
        - subnet: ${MVLAN_SUBNET:?err}
          ip_range: ${MVLAN_RANGE:?err}
          gateway: ${MVLAN_GW:?err}
